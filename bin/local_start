#!/bin/bash
export NODE_ENV=local

# temporarily redirect 80 -> 3000
# Linux
# sudo iptables -A PREROUTING -t nat -i eth0 -p tcp --dport 80 -j REDIRECT --to-port 3000
# OSX
echo "
rdr pass inet proto tcp from any to any port 80 -> 127.0.0.1 port 7000
rdr pass inet proto tcp from any to any port 443 -> 127.0.0.1 port 7443
" | sudo pfctl -ef -

# Start app
npm install
pm2 startOrRestart ecosystem.json --no-daemon --no-color --env ${NODE_ENV}

# Open browser
sleep 4
open `node -e "console.log(require('./lib/config').get('site.host'));"`
